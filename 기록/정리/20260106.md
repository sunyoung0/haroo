# 일기 좋아요 기능

- Toggle 방식으로 좋아요가 없는 상태에서 요청 시 `추가`, 있는 상태에서 요청시 `취소`
- 중복 방지 : 한 사용자는 하나의 일기에 대해 한번의 좋아요만 가능
- 일기 상세 내용 조회 시 총 좋아요 수와 현재 사용자의 좋아요 여부 판단 가능

- DB : user와 diary 사이의 다대다(N:M) 관게를 일대다-다대일로 풀어서 관리
  diary_id와 user_id를 하나의 FK로 묶어서 관리 (어떤 일기인지 누가 눌렀는지)

- service : 기존 데이터 존재 여부에 따라 삭제 또는 저장을 함

- 상세 정보 조회 시 반환하는 ResponseDto에 좋아요 상태를 포함

## Optional 체이닝(Chaining)(함수형 스타일)

- .map(), .filter(), .flatMap(), .orElseGet() 처럼 Optional이 제공하는 메서드들을 마침표(.)로 계속 연결해서 사용하는 방식

- 체이닝 방식의 장점
코드가 선언적 : if문을 써서 "어떻게(How)" 처리할지 기술하는 게 아니라, "무엇을(What)" 할지(값 있으면 삭제하고 메시지 반환해라) 기술하는 방식

불필요한 변수 선언이 사라짐: Optional<DiaryLike> like = ... 처럼 중간 결과를 저장할 변수를 굳이 만들지 않아도 됨

Null 안정성: if(like != null) 같은 체크 없이도 Optional 내부에서 안전하게 흐름이 제어됨

흐름을 따라가는 방식
```java
return diaryLikeRepository.findByDiaryAndUser(diary, user)
        .map(like -> {
            diaryLikeRepository.delete(like);
            return "좋아요 취소 완료";
        }) // 여기까지 값이 있을 때의 사슬
        .orElseGet(() -> {
            diaryLikeRepository.save(new DiaryLike(diary, user));
            return "좋아요 완료";
        }); // 여기까지 값이 없을 때의 사슬
```