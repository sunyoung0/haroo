# 회원가입/로그인 유효성 검사 로직 수정

## Zod - 유효성 검사를 위해 가장 많이 사용되는 react 라이브러리

- 지금처럼 if, else, regex를 직접 작성하면 코드가 길어지고 복잡해지는데, Zod를 쓰면 **"데이터의 형태(Schema)"**를 정의하는 것만으로 검증이 끝남.

- 장점

  - 가독성: "이메일 형식이어야 하고, 최소 8자여야 한다"는 말을 코드로 읽기 쉽게 정의

  - 재사용성: 한 번 정의한 스키마를 회원가입, 로그인 등 여러 곳에서 돌려쓸 수 있음

  - 타입 자동 생성: TypeScript 유저라면 Zod 스키마로부터 타입을 자동으로 추출할 수 있어 편리

```java
// 기존 방식
if (!emailRegex.test(value)) {
  setErrors({ email: "이메일 형식이 아닙니다." });
}
if (value.length < 8) {
  setErrors({ password: "8자 이상이어야 합니다." });
}

// zod 방식
import { z } from "zod";

const loginSchema = z.object({
  email: z.string().email("올바른 이메일 형식이 아닙니다."),
  password: z
    .string()
    .min(8, "비밀번호는 최소 8자 이상이어야 합니다.")
    .regex(/[A-Z]/, "대문자를 포함해야 합니다.") // 정규식도 체이닝 가능
});
```

```java
// 원래 작성 한 방식
  // 이메일, 비밀번호 조건 설정
  // 1. 도메인 끝(TLD)이 최소 2자 이상 (예: .com, .kr, .net)
  // 2. 숫자로만 된 도메인 끝자리 방지
  const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{3,}$/;

  const passwordRegex =
    /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+={}[\]:;"'<>,.?/\\|-]).{8,}$/; "

  const handleBlur = (event: React.FocusEvent<HTMLInputElement>) => {
    const { name, value } = event.target;

    // 값이 비어있으면 검사하지 않고 리턴 (필수값 체크는 handleSave에서 수행)
    if (!value) return;

    if (name === "email") {
      if (!emailRegex.test(value)) {
        setErrors((prev) => ({
          ...prev,
          email: "올바른 이메일 형식이 아닙니다. (예: user@example.com)",
        }));
      }
    }

    if (name === "password") {
      if (!passwordRegex.test(value)) {
        setErrors((prev) => ({
          ...prev,
          password:
            "비밀번호는 8자 이상, 영문/숫자/특수문자를 포함해야 합니다.",
        }));
      }
    }

    if (name === "nickname") {
      if (value.length < 2 || value.length > 10) {
        setErrors((prev) => ({
          ...prev,
          nickname: "닉네임은 2~10자 사이여야 합니다.",
        }));
      }
    }
  };

  const handleChange = (event: ChangeEvent<HTMLInputElement>) => {
    setSignUp({ ...signUp, [event.target.name]: event.target.value });

    // 사용자가 타이핑을 시작하면 해당 필드의 빨간 에러 메시지를 즉시 지워줌
    if (errors[event.target.name as keyof typeof errors]) {
      setErrors({ ...errors, [event.target.name]: "" });
    }
  };

```

```java
// React Hook Form + Zod 으로 수정
// react-hook-form 설정
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<SignUpFormData>({
    resolver: zodResolver(signUpSchema),
    mode: "onBlur",
  });

  // 가입 처리
  const onSubmit = async (data: SignUpFormData) => {
    try {
      await axios.post(
        `${import.meta.env.VITE_API_BASE_URL}/auth/register`,
        data
      );
      showSnackbar("회원가입 성공! 로그인 페이지로 이동합니다.", "success");
      setTimeout(() => navigate("/auth/login"), 1500);
    } catch (error) {
      console.error("회원가입 실패 : ", error);

      // Axios 에러인지 확인하는 타입 가드
      if (axios.isAxiosError(error)) {
        // 이 안에서 error를 AxiosError 타입으로 인식
        const serverMessage =
          error.response?.data?.message || "회원가입 중 오류가 발생했습니다.";
        const status = error.response?.status;
        if (status === 409) {
          showSnackbar(serverMessage, "warning");
        } else {
          // 400 Bad Request: 입력값 형식 오류 등
          showSnackbar(serverMessage, "warning");
        }
      } else {
        // 네트워크 에러나 코드 에러 등 Axios 에러가 아닌 경우
        showSnackbar("예상치 못한 오류가 발생했습니다.", "error");
        console.error("Unknown error:", error);
      }
    }
  };
```